<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anna App</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script> 

    <style>
        :root { --app-bg: #f2f4f7; --card-bg: #ffffff; --text-main: #212529; --app-primary: #0d6efd; --nav-height: 60px; }
        body { background: var(--app-bg); color: var(--text-main); font-family: sans-serif; margin: 0; padding: 0; padding-top: 60px; padding-bottom: 70px; user-select: none; }
        
        /* HEADER */
        .app-header { position: fixed; top: 0; left: 0; width: 100%; height: 60px; background: var(--card-bg); z-index: 1050; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 5px rgba(0,0,0,0.1); }
        
        /* FOOTER NAV */
        .nav-wrapper { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: var(--card-bg); z-index: 1050; border-top: 1px solid #dee2e6; display: flex; justify-content: space-around; align-items: center; }
        .nav-btn { background: none; border: none; color: #aaa; flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; }
        .nav-btn i { font-size: 22px; margin-bottom: 2px; }
        .nav-btn span { font-size: 10px; font-weight: 500; }
        .nav-btn.active { color: var(--app-primary); }

        /* FAB (PLUS BUTTON) */
        .fab-main { position: fixed; bottom: 75px; right: 20px; width: 55px; height: 55px; background: var(--app-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; z-index: 1060; box-shadow: 0 4px 10px rgba(13, 110, 253, 0.4); cursor: pointer; }

        /* SCREENS */
        .screen { display: none; padding: 15px; }
        .screen.active { display: block; animation: fadeEffect 0.3s; }
        @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }

        /* CARDS */
        .card { border: none; border-radius: 12px; background: var(--card-bg); margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* OVERLAYS (Auth, Settings) */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--app-bg); z-index: 2000; display: none; overflow-y: auto; padding-bottom: 50px; }
        .overlay.open { display: block; }
        
        /* AUTH SPECIFIC */
        #auth-overlay { background: #fff; z-index: 3000; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <div id="auth-overlay" class="overlay open">
        <div style="width: 85%; max-width: 350px; text-align: center;">
            <h2 class="fw-bold text-primary mb-4">Anna App</h2>
            <div id="login-box">
                <input type="email" id="login-email" class="form-control mb-3 p-3 rounded-pill" placeholder="Email">
                <input type="password" id="login-pass" class="form-control mb-3 p-3 rounded-pill" placeholder="Password">
                <button class="btn btn-primary w-100 rounded-pill py-2 fw-bold" onclick="handleLogin()">Login</button>
                <p class="mt-3">New? <b class="text-primary" onclick="toggleAuth('signup')">Register</b></p>
            </div>
            <div id="signup-box" style="display:none;">
                <input type="text" id="signup-name" class="form-control mb-3 p-3 rounded-pill" placeholder="Full Name">
                <input type="email" id="signup-email" class="form-control mb-3 p-3 rounded-pill" placeholder="Email">
                <input type="password" id="signup-pass" class="form-control mb-3 p-3 rounded-pill" placeholder="Password">
                <button class="btn btn-primary w-100 rounded-pill py-2 fw-bold" onclick="handleSignup()">Sign Up</button>
                <p class="mt-3">Have account? <b class="text-primary" onclick="toggleAuth('login')">Login</b></p>
            </div>
            <div id="auth-msg" class="text-danger mt-2 small"></div>
        </div>
    </div>

    <div class="app-header">
        <div class="fw-bold fs-4 text-primary"><i class="bi bi-exclude"></i> Anna</div>
        <div class="d-flex gap-3">
            <i class="bi bi-chat-dots fs-4" onclick="toggleOverlay('message-overlay')"></i>
            <i class="bi bi-bell fs-4" onclick="toggleOverlay('notif-overlay')"></i>
        </div>
    </div>

    <div id="home-screen" class="screen active">
        <div id="feed-container">
            <div class="text-center mt-5 text-muted">
                <div class="spinner-border text-primary"></div>
                <p class="mt-2">Connecting to Anna Server...</p>
            </div>
        </div>
    </div>

    <div id="search-screen" class="screen">
        <input type="text" class="form-control rounded-pill mb-3 py-2 border-0 shadow-sm" placeholder="Search exams...">
        <div class="card p-3">
            <h6 class="text-muted small fw-bold">TRENDING</h6>
            <div class="d-flex justify-content-between py-2 border-bottom"><span>#UPSCResult</span> <small class="text-danger">Live</small></div>
            <div class="d-flex justify-content-between py-2"><span>#SSC_CGL</span> <small class="text-success">New</small></div>
        </div>
    </div>

    <div id="study-screen" class="screen">
        <div class="d-flex gap-2 overflow-auto mb-3 no-scrollbar">
            <button class="btn btn-primary rounded-pill btn-sm px-3">All</button>
            <button class="btn btn-light border rounded-pill btn-sm px-3 whitespace-nowrap">SSC</button>
            <button class="btn btn-light border rounded-pill btn-sm px-3 whitespace-nowrap">UPSC</button>
            <button class="btn btn-light border rounded-pill btn-sm px-3 whitespace-nowrap">Class 12</button>
        </div>
        <div class="row g-2 text-center">
            <div class="col-4"><div class="card p-3 mb-1 d-flex align-items-center justify-content-center" style="height:70px"><i class="bi bi-file-pdf fs-2 text-danger"></i></div><small>Notes</small></div>
            <div class="col-4"><div class="card p-3 mb-1 d-flex align-items-center justify-content-center" style="height:70px"><i class="bi bi-clock fs-2 text-warning"></i></div><small>Papers</small></div>
            <div class="col-4"><div class="card p-3 mb-1 d-flex align-items-center justify-content-center" style="height:70px"><i class="bi bi-check-circle fs-2 text-success"></i></div><small>Tests</small></div>
            <div class="col-4"><div class="card p-3 mb-1 d-flex align-items-center justify-content-center" style="height:70px"><i class="bi bi-list-task fs-2 text-primary"></i></div><small>Syllabus</small></div>
            <div class="col-4"><div class="card p-3 mb-1 d-flex align-items-center justify-content-center" style="height:70px"><i class="bi bi-calendar fs-2 text-info"></i></div><small>Dates</small></div>
            <div class="col-4"><div class="card p-3 mb-1 d-flex align-items-center justify-content-center" style="height:70px"><i class="bi bi-book fs-2 text-secondary"></i></div><small>Books</small></div>
        </div>
        <h6 class="text-muted small fw-bold mt-4 px-1">UPDATES</h6>
        <div class="card p-3">
            <div class="d-flex gap-3 align-items-center">
                <i class="bi bi-file-earmark-text fs-3 text-danger"></i>
                <div><h6 class="m-0 fw-bold">SSC Notification</h6><small class="text-muted">2 hours ago</small></div>
            </div>
        </div>
    </div>

    <div id="profile-screen" class="screen">
        <div class="card p-3 text-center">
            <img src="" id="profile-dp" class="rounded-circle border border-2 border-primary mb-2" width="80" height="80">
            <h5 class="fw-bold m-0" id="profile-name">Loading...</h5>
            <small class="text-muted" id="profile-email">...</small>
            <div class="d-flex justify-content-around mt-3 border-top pt-2">
                <div><b>12</b><br><small>Posts</small></div>
                <div><b>1.5k</b><br><small>Fans</small></div>
                <div><b>400</b><br><small>Following</small></div>
            </div>
        </div>
        <div class="card overflow-hidden">
            <div class="list-group list-group-flush">
                <button class="list-group-item list-group-item-action py-3" onclick="toggleOverlay('account-overlay')">
                    <i class="bi bi-person-circle me-2 text-primary"></i> Account Centre <i class="bi bi-chevron-right float-end small mt-1"></i>
                </button>
                <button class="list-group-item list-group-item-action py-3" onclick="toggleOverlay('settings-overlay')">
                    <i class="bi bi-gear me-2 text-primary"></i> Settings <i class="bi bi-chevron-right float-end small mt-1"></i>
                </button>
                <button class="list-group-item list-group-item-action py-3">
                    <i class="bi bi-question-circle me-2 text-primary"></i> Help Centre <i class="bi bi-chevron-right float-end small mt-1"></i>
                </button>
            </div>
        </div>
        <button class="btn btn-outline-danger w-100 rounded-pill mt-3 fw-bold" onclick="doLogout()">Log Out</button>
    </div>

    <div id="fab" class="fab-main" data-bs-toggle="modal" data-bs-target="#postModal"><i class="bi bi-plus-lg"></i></div>

    <div class="nav-wrapper">
        <button class="nav-btn active" onclick="switchTab('home', this)">
            <i class="bi bi-house-door-fill"></i><span>Home</span>
        </button>
        <button class="nav-btn" onclick="switchTab('search', this)">
            <i class="bi bi-search"></i><span>Search</span>
        </button>
        <button class="nav-btn" onclick="switchTab('study', this)">
            <i class="bi bi-book-half"></i><span>Study</span>
        </button>
        <button class="nav-btn" onclick="switchTab('profile', this)">
            <i class="bi bi-person"></i><span>Profile</span>
        </button>
    </div>

    <div id="settings-overlay" class="overlay">
        <div class="app-header position-sticky top-0 border-bottom">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-arrow-left fs-4" onclick="toggleOverlay('settings-overlay')"></i> <h5 class="m-0">Settings</h5>
            </div>
        </div>
        <div class="container mt-3">
            <h6 class="text-muted small fw-bold px-2 mb-2">PREFERENCES</h6>
            <div class="card p-2">
                <div class="d-flex justify-content-between p-2 align-items-center border-bottom">
                    <span><i class="bi bi-moon me-2"></i> Dark Mode</span> 
                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox" onchange="document.body.classList.toggle('bg-dark'); document.body.classList.toggle('text-white')"></div>
                </div>
                <div class="d-flex justify-content-between p-2 align-items-center">
                    <span><i class="bi bi-bell me-2"></i> Notifications</span> 
                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox" checked></div>
                </div>
            </div>
            <h6 class="text-muted small fw-bold px-2 mt-3 mb-2">DATA</h6>
            <div class="card p-2">
                <div class="d-flex justify-content-between p-2 align-items-center">
                    <span><i class="bi bi-hdd-network me-2"></i> Data Saver</span> 
                    <div class="form-check form-switch"><input class="form-check-input" type="checkbox"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="account-overlay" class="overlay">
        <div class="app-header position-sticky top-0 border-bottom">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-arrow-left fs-4" onclick="toggleOverlay('account-overlay')"></i> <h5 class="m-0">Account</h5>
            </div>
        </div>
        <div class="container mt-3">
            <div class="text-center mb-4">
                <img src="" id="ac-img" class="rounded-circle border border-2 border-primary" width="80" height="80">
                <p class="text-primary small mt-1">Change Photo</p>
            </div>
            <label class="small text-muted fw-bold">Full Name</label>
            <input type="text" id="edit-name" class="form-control mb-3">
            <label class="small text-muted fw-bold">Email (Read Only)</label>
            <input type="text" id="edit-email" class="form-control mb-3 bg-light" readonly>
            <button class="btn btn-primary w-100 rounded-pill" onclick="saveProfile()">Save Changes</button>
        </div>
    </div>

    <div id="message-overlay" class="overlay"><div class="p-3"><i class="bi bi-arrow-left fs-4" onclick="toggleOverlay('message-overlay')"></i><h5 class="mt-4 text-center text-muted">No Messages</h5></div></div>
    <div id="notif-overlay" class="overlay"><div class="p-3"><i class="bi bi-arrow-left fs-4" onclick="toggleOverlay('notif-overlay')"></i><h5 class="mt-4 text-center text-muted">No Notifications</h5></div></div>

    <div class="modal fade" id="postModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
            <div class="modal-content border-0 rounded-4">
                <div class="modal-header border-0 pb-0"><h5 class="modal-title">Create Post</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <textarea id="post-input" class="form-control border-0 fs-5" rows="4" placeholder="What's on your mind?"></textarea>
                </div>
                <div class="modal-footer border-0 pt-0"><button class="btn btn-primary w-100 rounded-pill" onclick="submitPost()">Post</button></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- CONFIG ---
        const firebaseConfig = { 
            apiKey: "AIzaSyA_suE-En5oIv3z04gJV5TPhlDwYyx-QFI", 
            authDomain: "masd-repo-git.firebaseapp.com", 
            projectId: "masd-repo-git", 
            storageBucket: "masd-repo-git.firebasestorage.app", 
            messagingSenderId: "317994984658", 
            appId: "1:317994984658:web:c55231ca09e70341c8f90b" 
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- AUTH LOGIC ---
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-overlay').classList.remove('open');
                loadUserData(user);
                loadFeed();
            } else {
                document.getElementById('auth-overlay').classList.add('open');
            }
        });

        // --- NAVIGATION ---
        function switchTab(id, btn) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(id + '-screen').classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            document.getElementById('fab').style.display = (id === 'home') ? 'flex' : 'none';
        }

        function toggleOverlay(id) {
            const el = document.getElementById(id);
            if (el.classList.contains('open')) el.classList.remove('open');
            else el.classList.add('open');
        }

        function toggleAuth(type) {
            document.getElementById('login-box').style.display = type === 'login' ? 'block' : 'none';
            document.getElementById('signup-box').style.display = type === 'signup' ? 'block' : 'none';
        }

        // --- ACTIONS ---
        function handleLogin() {
            const e = document.getElementById('login-email').value;
            const p = document.getElementById('login-pass').value;
            auth.signInWithEmailAndPassword(e, p).catch(err => document.getElementById('auth-msg').innerText = err.message);
        }
        function handleSignup() {
            const n = document.getElementById('signup-name').value;
            const e = document.getElementById('signup-email').value;
            const p = document.getElementById('signup-pass').value;
            auth.createUserWithEmailAndPassword(e, p).then(res => {
                res.user.updateProfile({displayName: n}).then(() => location.reload());
            }).catch(err => document.getElementById('auth-msg').innerText = err.message);
        }
        function doLogout() { if(confirm("Logout?")) auth.signOut(); }

        function loadUserData(user) {
            const name = user.displayName || "User";
            const dp = `https://ui-avatars.com/api/?name=${name}&background=0d6efd&color=fff`;
            
            // Profile Screen
            document.getElementById('profile-name').innerText = name;
            document.getElementById('profile-email').innerText = user.email;
            document.getElementById('profile-dp').src = dp;
            
            // Account Overlay
            document.getElementById('edit-name').value = name;
            document.getElementById('edit-email').value = user.email;
            document.getElementById('ac-img').src = dp;
        }

        function saveProfile() {
            const n = document.getElementById('edit-name').value;
            auth.currentUser.updateProfile({displayName: n}).then(() => {
                alert("Profile Updated!");
                toggleOverlay('account-overlay');
                loadUserData(auth.currentUser);
            });
        }

        function submitPost() {
            const txt = document.getElementById('post-input').value;
            if(!txt) return;
            db.collection('posts').add({
                text: txt,
                userName: auth.currentUser.displayName,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('post-input').value = "";
                bootstrap.Modal.getInstance(document.getElementById('postModal')).hide();
            });
        }

        function loadFeed() {
            const container = document.getElementById('feed-container');
            db.collection('posts').orderBy('timestamp', 'desc').onSnapshot(snap => {
                if(snap.empty) { container.innerHTML = "<p class='text-center mt-5'>No posts yet. Be the first!</p>"; return; }
                let html = "";
                snap.forEach(doc => {
                    let d = doc.data();
                    let dp = `https://ui-avatars.com/api/?name=${d.userName}&background=random&color=fff`;
                    html += `
                    <div class="card p-3 mb-3">
                        <div class="d-flex gap-2 mb-2">
                            <img src="${dp}" class="rounded-circle" width="40" height="40">
                            <div><h6 class="m-0 fw-bold">${d.userName}</h6><small class="text-muted">Just now</small></div>
                        </div>
                        <p>${d.text}</p>
                        <div class="d-flex justify-content-between text-muted border-top pt-2">
                            <i class="bi bi-heart"></i> <i class="bi bi-chat"></i> <i class="bi bi-share"></i>
                        </div>
                    </div>`;
                });
                container.innerHTML = html;
            });
        }
    </script>
</body>
</html>
