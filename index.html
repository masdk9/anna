<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anna App</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <style>
        :root {
            --app-bg: #f2f4f7;
            --card-bg: #ffffff;
            --text-main: #212529;
            --border-color: #dee2e6;
            --app-primary: #0d6efd;
            --nav-height: 65px;
        }
        body.dark-theme {
            --app-bg: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --border-color: #2c2c2c;
        }
        body {
            margin: 0; padding-bottom: 90px;
            font-family: 'Jost', sans-serif;
            background: var(--app-bg); color: var(--text-main);
            overflow-x: hidden;
        }
        
        /* ðŸ”´ MOST IMPORTANT: Screen Hiding Logic */
        .screen { display: none !important; } /* Sab chupa do */
        .screen.active { display: block !important; } /* Sirf active wala dikhao */

        /* Auth Screen */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 9999; background: #f0f2f5; display: none; }
        #auth-screen.active { display: flex !important; justify-content: center; align-items: center; }
        .main { width: 350px; height: 520px; background: #fff; overflow: hidden; border-radius: 10px; position: relative; }
        #chk { display: none; }
        .login, .signup { position: relative; width: 100%; height: 100%; }
        .signup { height: 460px; background: var(--app-primary); border-radius: 60% / 10%; transform: translateY(-170px); transition: .8s; }
        .login label, .signup label { font-size: 2.3em; margin: 50px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; }
        .login label { color: var(--app-primary); } .signup label { color: #fff; transform: scale(.6); }
        input { width: 60%; height: 20px; background: #e0dede; margin: 20px auto; padding: 10px; border: none; border-radius: 5px; display: block; }
        button { width: 60%; height: 40px; margin: 20px auto; background: var(--app-primary); color: #fff; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; display: block; }
        .signup button { background: #fff; color: var(--app-primary); }
        #chk:checked ~ .signup { transform: translateY(-500px); }

        /* Components */
        .card, .list-group-item, .modal-content, .form-control { background: var(--card-bg) !important; color: var(--text-main) !important; border-color: var(--border-color) !important; }
        .app-header { position: sticky; top: 0; z-index: 1020; background: var(--card-bg) !important; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; height: 60px; }
        .nav-wrapper { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: var(--card-bg) !important; border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; z-index: 1030; }
        .nav-item-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #adb5bd; background: transparent; border: none; }
        .nav-item-btn.active { color: var(--app-primary); }
        .fab-main { position: fixed; bottom: 85px; right: 20px; width: 58px; height: 58px; background: linear-gradient(135deg, #0d6efd, #0a58ca); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; z-index: 1040; }

        /* Overlays */
        #settings-screen, #account-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: var(--app-bg); z-index: 2000; display: none; overflow-y: auto; }
        #settings-screen.active, #account-screen.active { display: block !important; }

        /* Helpers */
        .form-check-input:checked { background-color: #0d6efd !important; border-color: #0d6efd !important; }
        body.dark-theme .bi { color: #a0a0a0; }
        body.dark-theme .text-dark { color: #e0e0e0 !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        /* Hide UI when logged out */
        body.not-logged-in .app-header, body.not-logged-in .nav-wrapper, body.not-logged-in #fab-btn, body.not-logged-in .container { display: none !important; }
    </style>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script> 
</head>
<body class="not-logged-in">

    <div id="auth-screen" class="screen active">
        <div class="main">  
            <input type="checkbox" id="chk" aria-hidden="true">
            <div class="login">
                <form onsubmit="event.preventDefault(); handleLogin();">
                    <label for="chk" aria-hidden="true">Login</label>
                    <input type="email" id="login-email" placeholder="Email" required>
                    <input type="password" id="login-pass" placeholder="Password" required>
                    <button type="submit">Login</button>
                    <div id="auth-error" class="error-msg"></div>
                </form>
            </div>
            <div class="signup">
                <form onsubmit="event.preventDefault(); handleSignup();">
                    <label for="chk" aria-hidden="true">Register</label>
                    <input type="email" id="signup-email" placeholder="Email" required>
                    <input type="text" id="signup-name" placeholder="Username" required>
                    <input type="password" id="signup-pass" placeholder="Password" required>
                    <input type="password" id="signup-confirm-pass" placeholder="Confirm Password" required>
                    <button type="submit">Register</button>
                    <div id="signup-error" class="error-msg" style="color: yellow;"></div>
                </form>
            </div>
        </div>
    </div>
    <div class="app-header">
        <div class="app-logo"><i class="bi bi-exclude text-primary"></i> Anna App</div>
        <div class="d-flex gap-3 align-items-center">
            <i class="bi bi-chat-dots header-icon" onclick="openScreen('message')"></i>
            <i class="bi bi-bell header-icon" onclick="openScreen('notification')"></i>
        </div>
    </div>
    <div id="home-screen" class="screen container px-3 mt-3 pb-5">
        <div id="posts-container" class="pb-5">
            <div class="text-center text-muted mt-5"><div class="spinner-border text-primary"></div></div>
        </div>
    </div>
    <div id="search-screen" class="screen container px-3 mt-3 pb-5">
        <input type="text" class="form-control rounded-pill mb-3 border-0 shadow-sm" style="height: 50px;" placeholder="Search exams...">
        <h6 class="text-muted small fw-bold px-2 mb-2">TRENDING</h6>
        <div class="card border-0 shadow-sm rounded-4">
            <div class="list-group list-group-flush rounded-3">
                <div class="list-group-item py-3">#UPSCResult <span class="float-end text-muted small">Live</span></div>
                <div class="list-group-item py-3">#RailwayVacancy <span class="float-end text-muted small">Trending</span></div>
            </div>
        </div>
    </div>
    <div id="study-screen" class="screen container px-3 mt-3 pb-5">
        <div class="d-flex gap-2 overflow-auto pb-2 mb-3 no-scrollbar">
            <button class="btn btn-primary rounded-pill btn-sm px-3">All</button>
            <button class="btn btn-light border rounded-pill btn-sm px-3 whitespace-nowrap">SSC/Bank</button>
            <button class="btn btn-light border rounded-pill btn-sm px-3 whitespace-nowrap">UPSC/IAS</button>
        </div>
        <div class="row g-3">
            <div class="col-4 text-center">
                <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-file-earmark-pdf fs-1 text-danger"></i></div>
                <small class="fw-bold text-dark">Notes</small>
            </div>
            <div class="col-4 text-center">
                <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-clock-history fs-1 text-warning"></i></div>
                <small class="fw-bold text-dark">Papers</small>
            </div>
            <div class="col-4 text-center">
                <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-clipboard-check fs-1 text-success"></i></div>
                <small class="fw-bold text-dark">Tests</small>
            </div>
            <div class="col-4 text-center">
                <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-list-check fs-1 text-primary"></i></div>
                <small class="fw-bold text-dark">Syllabus</small>
            </div>
            <div class="col-4 text-center">
                <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-calendar-event fs-1 text-info"></i></div>
                <small class="fw-bold text-dark">Calendar</small>
            </div>
            <div class="col-4 text-center">
                <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-book fs-1 text-secondary"></i></div>
                <small class="fw-bold text-dark">Books</small>
            </div>
        </div>
        <h6 class="text-muted small fw-bold mt-4 mb-2 px-1">UPDATES</h6>
        <div class="card border-0 shadow-sm rounded-4">
            <div class="list-group list-group-flush">
                <div class="list-group-item p-3">
                    <div class="d-flex align-items-center gap-3"><i class="bi bi-file-pdf text-danger fs-4"></i><div><h6 class="mb-0 fw-bold text-dark">SSC Notification</h6><small class="text-muted">2 hours ago</small></div><i class="bi bi-download ms-auto text-primary"></i></div>
                </div>
            </div>
        </div>
    </div>
    <div id="message-screen" class="screen container px-3 mt-3 pb-5">
        <h5 class="fw-bold mb-3">Messages</h5>
        <div class="card border-0 shadow-sm rounded-4 p-4 text-center text-muted">
            <i class="bi bi-chat-square-text fs-1 mb-2"></i><p>Start a discussion.</p>
        </div>
    </div>
    <div id="notification-screen" class="screen container px-3 mt-3 pb-5">
        <h5 class="fw-bold mb-3">Notifications</h5>
        <div class="card border-0 shadow-sm rounded-4 p-4 text-center text-muted">No new notifications.</div>
    </div>
    <div id="profile-screen" class="screen container px-3 mt-3 pb-5">
        <div class="card border-0 shadow-sm rounded-4 mx-2 mt-2 p-3">
            <div class="d-flex align-items-center gap-3 mb-3">
                <div class="position-relative">
                    <img src="https://ui-avatars.com/api/?name=User" class="rounded-circle border" style="width: 75px; height: 75px; object-fit: cover;" id="profile-img-display">
                    <div class="position-absolute bottom-0 end-0 bg-primary text-white rounded-circle d-flex align-items-center justify-content-center border border-white" style="width: 26px; height: 26px;"><i class="bi bi-camera-fill" style="font-size: 13px;"></i></div>
                </div>
                <div style="line-height: 1.2;">
                    <h5 class="fw-bold mb-0 text-dark" id="profile-name-display">User Name</h5>
                    <small class="text-muted" id="profile-email-display">@username</small><br>
                    <span class="badge bg-light text-primary border mt-1 rounded-pill">Student</span>
                </div>
            </div>
            <div class="mb-3"><p class="small text-dark mb-0">ðŸŽ¯ Aspirant | ðŸ“š Student</p></div>
            <div class="d-flex justify-content-between align-items-center text-center border-top pt-3">
                <div style="flex: 1;"><h6 class="fw-bold mb-0 text-dark">12</h6><small class="text-muted" style="font-size: 11px;">Posts</small></div>
                <div style="border-left: 1px solid #dee2e6; height: 25px;"></div>
                <div style="flex: 1;"><h6 class="fw-bold mb-0 text-dark">1.5k</h6><small class="text-muted" style="font-size: 11px;">Followers</small></div>
                <div style="border-left: 1px solid #dee2e6; height: 25px;"></div>
                <div style="flex: 1;"><h6 class="fw-bold mb-0 text-dark">400</h6><small class="text-muted" style="font-size: 11px;">Following</small></div>
            </div>
        </div>
        <div class="card border-0 shadow-sm rounded-4 mx-2 mt-3 overflow-hidden">
            <div class="list-group list-group-flush">
                <div class="list-group-item p-3 d-flex align-items-center" onclick="openAccountCentre()">
                    <i class="bi bi-person-circle fs-5 me-3 text-primary"></i><div class="flex-grow-1"><h6 class="mb-0 fw-bold small text-dark">Account Centre</h6></div><i class="bi bi-chevron-right text-muted small"></i>
                </div>
                <div class="list-group-item p-3 d-flex align-items-center" onclick="openSettings()">
                    <i class="bi bi-gear fs-5 me-3 text-primary"></i><div class="flex-grow-1"><h6 class="mb-0 fw-bold small text-dark">Settings</h6></div><i class="bi bi-chevron-right text-muted small"></i>
                </div>
            </div>
        </div>
        <div class="d-grid px-3 mt-4 mb-5"><button class="btn btn-outline-danger rounded-pill py-2 fw-bold" onclick="handleLogout()">Logout</button></div>
    </div>
    <div id="settings-screen">
        <div class="app-header sticky-top bg-transparent shadow-none border-bottom-0">
            <div class="d-flex align-items-center gap-3"><i class="bi bi-arrow-left fs-4 text-dark" onclick="closeSettings()"></i><h5 class="mb-0 fw-bold text-dark">Settings</h5></div>
        </div>
        <div class="container pb-5 pt-2">
            <h6 class="text-muted small fw-bold mt-3 mb-2 px-2">PREFERENCES</h6>
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="list-group list-group-flush">
                    <div class="list-group-item p-3 d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-3"><i class="bi bi-moon fs-5"></i> <span>Dark Mode</span></div><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode()"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="account-screen">
        <div class="app-header sticky-top bg-transparent shadow-none border-bottom-0">
            <div class="d-flex align-items-center gap-3"><i class="bi bi-arrow-left fs-4 text-dark" onclick="closeAccountCentre()"></i><h5 class="mb-0 fw-bold text-dark">Account Centre</h5></div>
        </div>
        <div class="container pb-5 pt-2">
            <form id="account-form">
                <div class="mb-3"><label class="form-label small fw-bold text-muted">Name</label><input type="text" class="form-control rounded-3 py-2" id="ac-name"></div>
                <div class="d-grid gap-2 mt-4"><button type="button" class="btn btn-primary rounded-pill py-2 fw-bold" onclick="saveProfileChanges()">Save Changes</button></div>
            </form>
        </div>
    </div>
    <div id="fab-btn" class="fab-main" data-bs-toggle="modal" data-bs-target="#createPostModal"><i class="bi bi-plus-lg"></i></div>

    <div class="nav-wrapper">
        <button class="nav-item-btn active" onclick="switchTab('home', this)"><i class="bi bi-house-door-fill"></i><span>Home</span></button>
        <button class="nav-item-btn" onclick="switchTab('search', this)"><i class="bi bi-search"></i><span>Search</span></button>
        <button class="nav-item-btn" onclick="switchTab('study', this)"><i class="bi bi-book-half"></i><span>Study</span></button>
        <button class="nav-item-btn" onclick="switchTab('profile', this)"><i class="bi bi-person"></i><span>Profile</span></button>
    </div>
    <div class="modal fade" id="createPostModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
            <div class="modal-content border-0 rounded-4">
                <div class="modal-header border-0 pb-0"><h5 class="modal-title fw-bold">Create Post</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <textarea id="post-text" class="form-control border-0 fs-5 mb-3" rows="3" placeholder="What's on your mind?"></textarea>
                    <div id="poll-section" class="card bg-light border-0 rounded-3 p-3 mb-3" style="display: none;">
                        <input type="text" class="form-control mb-2 fw-bold border-0" placeholder="Question...">
                        <input type="text" class="form-control form-control-sm border-0 mb-2" placeholder="Option A">
                        <input type="text" class="form-control form-control-sm border-0 mb-2" placeholder="Option B">
                    </div>
                    <div class="card border rounded-pill p-2 mt-3">
                        <div class="d-flex justify-content-between px-2">
                            <div class="d-flex gap-1">
                                <button class="btn btn-light rounded-circle text-primary" onclick="document.getElementById('cam-input').click()"><i class="bi bi-camera-fill"></i></button><input type="file" id="cam-input" hidden>
                                <button class="btn btn-light rounded-circle text-danger" onclick="togglePoll()"><i class="bi bi-bar-chart-fill"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0"><button type="button" class="btn btn-primary w-100 rounded-pill py-2 fw-bold" onclick="savePost()">Post</button></div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>

</body>
</html>
