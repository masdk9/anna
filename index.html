<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anna App</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script> 

    <style>
        /* 1. BASIC RESET & THEME */
        :root { --app-bg: #f2f4f7; --card-bg: #ffffff; --text-main: #212529; --app-primary: #0d6efd; }
        body { background: var(--app-bg); color: var(--text-main); font-family: sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        
        /* 2. LAYOUT STRUCTURE */
        /* Header hamesha upar chipka rahega */
        header { position: fixed; top: 0; left: 0; width: 100%; height: 60px; background: var(--card-bg); z-index: 1000; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 0 15px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Footer (Nav) hamesha neeche chipka rahega */
        nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 65px; background: var(--card-bg); z-index: 1000; border-top: 1px solid #dee2e6; display: flex; justify-content: space-around; align-items: center; }
        
        /* Main Content: Header aur Footer ke beech me rahega */
        main { padding-top: 70px; padding-bottom: 80px; min-height: 100vh; }

        /* 3. SCREEN VISIBILITY LOGIC */
        /* Default sab band */
        .screen-section { display: none; }
        /* Jo active hai wahi dikhega */
        .screen-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* 4. COMPONENTS */
        .nav-btn { background: none; border: none; color: #aaa; flex: 1; display: flex; flex-direction: column; align-items: center; font-size: 12px; }
        .nav-btn i { font-size: 20px; margin-bottom: 2px; }
        .nav-btn.active { color: var(--app-primary); font-weight: bold; }
        
        .fab { position: fixed; bottom: 80px; right: 20px; width: 55px; height: 55px; background: var(--app-primary); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 1001; cursor: pointer; }

        /* 5. FULL SCREEN OVERLAYS (Auth/Settings) */
        .overlay-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--app-bg); z-index: 2000; display: none; overflow-y: auto; }
        .overlay-screen.open { display: block; }
        
        /* Auth specific */
        #auth-overlay { background: #fff; z-index: 3000; display: flex; justify-content: center; align-items: center; }
        
        /* Utilities */
        .card { border: none; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); background: var(--card-bg); margin-bottom: 15px; overflow: hidden; }
        .no-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="auth-overlay" class="overlay-screen open">
        <div style="width: 85%; max-width: 350px; text-align: center;">
            <h2 class="fw-bold text-primary mb-4">Anna App</h2>
            
            <div id="login-box">
                <input type="email" id="login-email" class="form-control mb-3" placeholder="Email">
                <input type="password" id="login-pass" class="form-control mb-3" placeholder="Password">
                <button class="btn btn-primary w-100 rounded-pill" onclick="handleLogin()">Login</button>
                <p class="mt-3 small">New here? <span class="text-primary fw-bold" onclick="toggleAuth('signup')" style="cursor:pointer">Register</span></p>
            </div>

            <div id="signup-box" style="display:none;">
                <input type="text" id="signup-name" class="form-control mb-3" placeholder="Full Name">
                <input type="email" id="signup-email" class="form-control mb-3" placeholder="Email">
                <input type="password" id="signup-pass" class="form-control mb-3" placeholder="Password">
                <button class="btn btn-primary w-100 rounded-pill" onclick="handleSignup()">Sign Up</button>
                <p class="mt-3 small">Have an account? <span class="text-primary fw-bold" onclick="toggleAuth('login')" style="cursor:pointer">Login</span></p>
            </div>
        </div>
    </div>


    <header id="main-header" style="display:none;"> <div class="fw-bold fs-4 text-primary"><i class="bi bi-exclude"></i></div>
        <div class="d-flex gap-3">
            <i class="bi bi-chat-dots fs-4" onclick="toggleOverlay('message-overlay')"></i>
            <i class="bi bi-bell fs-4" onclick="toggleOverlay('notif-overlay')"></i>
        </div>
    </header>

    <main id="main-content" class="container" style="display:none;"> <div id="tab-home" class="screen-section active">
            <div id="feed-loader" class="text-center mt-5"><div class="spinner-border text-primary"></div></div>
            <div id="feed-container"></div>
        </div>

        <div id="tab-search" class="screen-section">
            <input type="text" class="form-control rounded-pill mb-3" placeholder="Search...">
            <div class="card p-3">
                <h6 class="text-muted small fw-bold">TRENDING</h6>
                <div class="d-flex justify-content-between py-2 border-bottom"><span>#UPSCResult</span> <small class="text-danger">Live</small></div>
                <div class="d-flex justify-content-between py-2"><span>#SSC_CGL</span> <small class="text-success">New</small></div>
            </div>
        </div>

        <div id="tab-study" class="screen-section">
            <div class="d-flex gap-2 overflow-auto mb-3 no-scroll">
                <button class="btn btn-sm btn-primary rounded-pill px-3">All</button>
                <button class="btn btn-sm btn-light border rounded-pill px-3">SSC</button>
                <button class="btn btn-sm btn-light border rounded-pill px-3">UPSC</button>
            </div>
            <div class="row g-2">
                <div class="col-4 text-center"><div class="card p-3 mb-1"><i class="bi bi-file-pdf fs-1 text-danger"></i></div><small>Notes</small></div>
                <div class="col-4 text-center"><div class="card p-3 mb-1"><i class="bi bi-clock fs-1 text-warning"></i></div><small>Papers</small></div>
                <div class="col-4 text-center"><div class="card p-3 mb-1"><i class="bi bi-book fs-1 text-primary"></i></div><small>Books</small></div>
            </div>
        </div>

        <div id="tab-profile" class="screen-section">
            <div class="card p-3 text-center">
                <img src="" id="profile-dp" class="rounded-circle border border-2 border-primary mb-2" width="80" height="80">
                <h5 class="fw-bold m-0" id="profile-name">User</h5>
                <small class="text-muted" id="profile-email">@user</small>
                <div class="d-flex justify-content-around mt-3 border-top pt-2">
                    <div><b>12</b><br><small>Posts</small></div>
                    <div><b>1.5k</b><br><small>Fans</small></div>
                    <div><b>400</b><br><small>Following</small></div>
                </div>
            </div>
            <div class="card">
                <div class="list-group list-group-flush">
                    <button class="list-group-item list-group-item-action py-3" onclick="toggleOverlay('account-overlay')"><i class="bi bi-person me-2"></i> Account</button>
                    <button class="list-group-item list-group-item-action py-3" onclick="toggleOverlay('settings-overlay')"><i class="bi bi-gear me-2"></i> Settings</button>
                    <button class="list-group-item list-group-item-action py-3 text-danger" onclick="doLogout()"><i class="bi bi-box-arrow-right me-2"></i> Logout</button>
                </div>
            </div>
        </div>

    </main>

    <nav id="main-nav" style="display:none;"> <button class="nav-btn active" onclick="switchTab('home', this)"><i class="bi bi-house-door-fill"></i> Home</button>
        <button class="nav-btn" onclick="switchTab('search', this)"><i class="bi bi-search"></i> Search</button>
        <button class="nav-btn" onclick="switchTab('study', this)"><i class="bi bi-book"></i> Study</button>
        <button class="nav-btn" onclick="switchTab('profile', this)"><i class="bi bi-person"></i> Profile</button>
    </nav>

    <div id="fab" class="fab" style="display:none;" data-bs-toggle="modal" data-bs-target="#postModal"><i class="bi bi-plus-lg"></i></div>


    <div id="settings-overlay" class="overlay-screen">
        <div class="p-3 border-bottom d-flex align-items-center gap-3">
            <i class="bi bi-arrow-left fs-4" onclick="toggleOverlay('settings-overlay')"></i> <h5 class="m-0">Settings</h5>
        </div>
        <div class="container mt-3">
            <div class="card p-3 d-flex justify-content-between align-items-center flex-row">
                <span>Dark Mode</span> <div class="form-check form-switch"><input class="form-check-input" type="checkbox" onchange="document.body.classList.toggle('bg-dark'); document.body.classList.toggle('text-white');"></div>
            </div>
        </div>
    </div>

    <div id="account-overlay" class="overlay-screen">
        <div class="p-3 border-bottom d-flex align-items-center gap-3">
            <i class="bi bi-arrow-left fs-4" onclick="toggleOverlay('account-overlay')"></i> <h5 class="m-0">Edit Profile</h5>
        </div>
        <div class="container mt-3">
            <input type="text" id="edit-name" class="form-control mb-3" placeholder="Update Name">
            <button class="btn btn-primary w-100 rounded-pill" onclick="saveProfile()">Save</button>
        </div>
    </div>

    <div id="notif-overlay" class="overlay-screen">
        <div class="p-3 border-bottom d-flex align-items-center gap-3">
            <i class="bi bi-arrow-left fs-4" onclick="toggleOverlay('notif-overlay')"></i> <h5 class="m-0">Notifications</h5>
        </div>
        <div class="text-center mt-5 text-muted">No new alerts</div>
    </div>

    <div id="message-overlay" class="overlay-screen">
        <div class="p-3 border-bottom d-flex align-items-center gap-3">
            <i class="bi bi-arrow-left fs-4" onclick="toggleOverlay('message-overlay')"></i> <h5 class="m-0">Chats</h5>
        </div>
        <div class="text-center mt-5 text-muted">No chats started</div>
    </div>

    <div class="modal fade" id="postModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
            <div class="modal-content border-0 rounded-4">
                <div class="modal-header border-0"><h5 class="modal-title">New Post</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <textarea id="post-input" class="form-control border-0 fs-5" rows="4" placeholder="What's happening?"></textarea>
                </div>
                <div class="modal-footer border-0">
                    <button class="btn btn-primary rounded-pill px-4" onclick="submitPost()">Post</button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- CONFIG ---
        const firebaseConfig = { 
            apiKey: "AIzaSyA_suE-En5oIv3z04gJV5TPhlDwYyx-QFI", 
            authDomain: "masd-repo-git.firebaseapp.com", 
            projectId: "masd-repo-git", 
            storageBucket: "masd-repo-git.firebasestorage.app", 
            messagingSenderId: "317994984658", 
            appId: "1:317994984658:web:c55231ca09e70341c8f90b" 
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- AUTH STATE ---
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-overlay').classList.remove('open');
                document.getElementById('main-header').style.display = 'flex';
                document.getElementById('main-nav').style.display = 'flex';
                document.getElementById('main-content').style.display = 'block';
                document.getElementById('fab').style.display = 'flex';
                loadUserData(user);
                loadFeed();
            } else {
                document.getElementById('auth-overlay').classList.add('open');
                document.getElementById('main-header').style.display = 'none';
                document.getElementById('main-nav').style.display = 'none';
                document.getElementById('main-content').style.display = 'none';
                document.getElementById('fab').style.display = 'none';
            }
        });

        // --- NAVIGATION LOGIC ---
        function switchTab(tabId, btn) {
            // 1. Sab content chupa do
            document.querySelectorAll('.screen-section').forEach(el => el.classList.remove('active'));
            // 2. Jo manga wo dikhao
            document.getElementById('tab-' + tabId).classList.add('active');
            
            // 3. Button active karo
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            // 4. FAB sirf home pe dikhao
            document.getElementById('fab').style.display = (tabId === 'home') ? 'flex' : 'none';
        }

        function toggleOverlay(id) {
            const el = document.getElementById(id);
            if (el.classList.contains('open')) el.classList.remove('open');
            else el.classList.add('open');
        }

        function toggleAuth(type) {
            if(type === 'signup') {
                document.getElementById('login-box').style.display = 'none';
                document.getElementById('signup-box').style.display = 'block';
            } else {
                document.getElementById('signup-box').style.display = 'none';
                document.getElementById('login-box').style.display = 'block';
            }
        }

        // --- ACTIONS ---
        function handleLogin() {
            const e = document.getElementById('login-email').value;
            const p = document.getElementById('login-pass').value;
            auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
        }
        function handleSignup() {
            const n = document.getElementById('signup-name').value;
            const e = document.getElementById('signup-email').value;
            const p = document.getElementById('signup-pass').value;
            auth.createUserWithEmailAndPassword(e, p).then(res => {
                res.user.updateProfile({displayName: n}).then(() => location.reload());
            }).catch(err => alert(err.message));
        }
        function doLogout() { if(confirm("Exit?")) auth.signOut(); }

        function loadUserData(user) {
            document.getElementById('profile-name').innerText = user.displayName || "User";
            document.getElementById('profile-email').innerText = user.email;
            document.getElementById('profile-dp').src = `https://ui-avatars.com/api/?name=${user.displayName}&background=0d6efd&color=fff`;
            document.getElementById('edit-name').value = user.displayName;
        }

        function saveProfile() {
            const n = document.getElementById('edit-name').value;
            auth.currentUser.updateProfile({displayName: n}).then(() => {
                alert("Saved!"); 
                toggleOverlay('account-overlay');
                loadUserData(auth.currentUser);
            });
        }

        function submitPost() {
            const t = document.getElementById('post-input').value;
            if(!t) return;
            db.collection('posts').add({
                text: t,
                userName: auth.currentUser.displayName,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('post-input').value = "";
                bootstrap.Modal.getInstance(document.getElementById('postModal')).hide();
            });
        }

        function loadFeed() {
            db.collection('posts').orderBy('timestamp', 'desc').onSnapshot(snap => {
                let html = "";
                snap.forEach(doc => {
                    let d = doc.data();
                    let dp = `https://ui-avatars.com/api/?name=${d.userName}&background=random&color=fff`;
                    html += `
                    <div class="card p-3 mb-3">
                        <div class="d-flex gap-2 mb-2">
                            <img src="${dp}" class="rounded-circle" width="40" height="40">
                            <div><h6 class="m-0 fw-bold">${d.userName}</h6><small class="text-muted">Just now</small></div>
                        </div>
                        <p>${d.text}</p>
                        <div class="d-flex justify-content-between text-muted border-top pt-2">
                            <i class="bi bi-heart"></i> <i class="bi bi-chat"></i> <i class="bi bi-share"></i>
                        </div>
                    </div>`;
                });
                document.getElementById('feed-container').innerHTML = html;
                document.getElementById('feed-loader').style.display = 'none';
            });
        }
    </script>
</body>
</html>
