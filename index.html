<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anna App</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script> 

    <style>
        :root {
            --app-bg: #f2f4f7;
            --card-bg: #ffffff;
            --text-main: #212529;
            --border-color: #dee2e6;
            --app-primary: #0d6efd;
            --nav-height: 65px;
        }
        body.dark-theme {
            --app-bg: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --border-color: #2c2c2c;
        }
        body {
            margin: 0; padding-bottom: 90px;
            font-family: 'Jost', sans-serif;
            background: var(--app-bg); color: var(--text-main);
            overflow-x: hidden;
        }

        /* SCREEN LOGIC */
        .screen { display: none !important; }
        .screen.active { display: block !important; }

        /* AUTH */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 9999; background: #f0f2f5; display: flex !important; justify-content: center; align-items: center; }
        /* Jab login ho jaye, tab auth screen chupado */
        body.logged-in #auth-screen { display: none !important; }

        .main { width: 350px; height: 520px; background: #fff; overflow: hidden; border-radius: 10px; position: relative; }
        #chk { display: none; }
        .login, .signup { position: relative; width: 100%; height: 100%; }
        .signup { height: 460px; background: var(--app-primary); border-radius: 60% / 10%; transform: translateY(-170px); transition: .8s; }
        .login label, .signup label { font-size: 2.3em; margin: 50px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; }
        .login label { color: var(--app-primary); } .signup label { color: #fff; transform: scale(.6); }
        input { width: 60%; height: 20px; background: #e0dede; margin: 20px auto; padding: 10px; border: none; border-radius: 5px; display: block; }
        button { width: 60%; height: 40px; margin: 20px auto; background: var(--app-primary); color: #fff; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; display: block; }
        .signup button { background: #fff; color: var(--app-primary); }
        #chk:checked ~ .signup { transform: translateY(-500px); }

        /* HEADER & NAV */
        .app-header { position: sticky; top: 0; z-index: 1020; background: var(--card-bg) !important; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; height: 60px; }
        .nav-wrapper { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: var(--card-bg) !important; border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; z-index: 1030; }
        .nav-item-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #adb5bd; background: transparent; border: none; }
        .nav-item-btn.active { color: var(--app-primary); }
        
        /* FAB */
        .fab-main { position: fixed; bottom: 85px; right: 20px; width: 58px; height: 58px; background: linear-gradient(135deg, #0d6efd, #0a58ca); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; z-index: 1040; box-shadow: 0 4px 15px rgba(13, 110, 253, 0.4); cursor: pointer; }

        /* OVERLAYS */
        #settings-screen, #account-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: var(--app-bg); z-index: 2000; display: none; overflow-y: auto; }
        #settings-screen.active, #account-screen.active { display: block !important; }

        /* HELPERS */
        .card, .list-group-item, .modal-content, .form-control { background: var(--card-bg) !important; color: var(--text-main) !important; border-color: var(--border-color) !important; }
        .form-check-input:checked { background-color: #0d6efd !important; border-color: #0d6efd !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* HIDE UI IF NOT LOGGED IN */
        body:not(.logged-in) .app-header, 
        body:not(.logged-in) .nav-wrapper, 
        body:not(.logged-in) #fab-btn, 
        body:not(.logged-in) .container { display: none !important; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="main">  
            <input type="checkbox" id="chk" aria-hidden="true">
            <div class="login">
                <form onsubmit="event.preventDefault(); handleLogin();">
                    <label for="chk" aria-hidden="true">Login</label>
                    <input type="email" id="login-email" placeholder="Email" required>
                    <input type="password" id="login-pass" placeholder="Password" required>
                    <button type="submit">Login</button>
                    <div id="auth-error" class="error-msg" style="color:red; text-align:center; margin-top:10px;"></div>
                </form>
            </div>
            <div class="signup">
                <form onsubmit="event.preventDefault(); handleSignup();">
                    <label for="chk" aria-hidden="true">Register</label>
                    <input type="email" id="signup-email" placeholder="Email" required>
                    <input type="text" id="signup-name" placeholder="Username" required>
                    <input type="password" id="signup-pass" placeholder="Password" required>
                    <input type="password" id="signup-confirm-pass" placeholder="Confirm Password" required>
                    <button type="submit">Register</button>
                    <div id="signup-error" class="error-msg" style="color: yellow; text-align:center; margin-top:10px;"></div>
                </form>
            </div>
        </div>
    </div>

    <div class="app-header">
        <div class="app-logo"><i class="bi bi-exclude text-primary"></i> Anna App</div>
        <div class="d-flex gap-3 align-items-center">
            <i class="bi bi-chat-dots fs-4" onclick="openScreen('message')"></i>
            <i class="bi bi-bell fs-4" onclick="openScreen('notification')"></i>
        </div>
    </div>

    <div class="container px-3 mt-3 pb-5">
        
        <div id="home-screen" class="screen active">
            <div id="posts-container" class="pb-5">
                <div class="text-center text-muted mt-5"><div class="spinner-border text-primary"></div></div>
            </div>
        </div>

        <div id="search-screen" class="screen">
            <input type="text" class="form-control rounded-pill mb-3 border-0 shadow-sm" style="height: 50px;" placeholder="Search exams...">
            <h6 class="text-muted small fw-bold px-2 mb-2">TRENDING</h6>
            <div class="card border-0 shadow-sm rounded-4">
                <div class="list-group list-group-flush rounded-3">
                    <div class="list-group-item py-3">#UPSCResult <span class="float-end text-muted small">Live</span></div>
                    <div class="list-group-item py-3">#RailwayVacancy <span class="float-end text-muted small">Trending</span></div>
                </div>
            </div>
        </div>

        <div id="study-screen" class="screen">
            <div class="d-flex gap-2 overflow-auto pb-2 mb-3 no-scrollbar">
                <button class="btn btn-primary rounded-pill btn-sm px-3">All</button>
                <button class="btn btn-light border rounded-pill btn-sm px-3 whitespace-nowrap">SSC/Bank</button>
                <button class="btn btn-light border rounded-pill btn-sm px-3 whitespace-nowrap">UPSC/IAS</button>
            </div>
            <div class="row g-3">
                <div class="col-4 text-center">
                    <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-file-earmark-pdf fs-1 text-danger"></i></div>
                    <small class="fw-bold text-dark">Notes</small>
                </div>
                <div class="col-4 text-center">
                    <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-clock-history fs-1 text-warning"></i></div>
                    <small class="fw-bold text-dark">Papers</small>
                </div>
                <div class="col-4 text-center">
                    <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-clipboard-check fs-1 text-success"></i></div>
                    <small class="fw-bold text-dark">Tests</small>
                </div>
                <div class="col-4 text-center">
                    <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-list-check fs-1 text-primary"></i></div>
                    <small class="fw-bold text-dark">Syllabus</small>
                </div>
                <div class="col-4 text-center">
                    <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-calendar-event fs-1 text-info"></i></div>
                    <small class="fw-bold text-dark">Calendar</small>
                </div>
                <div class="col-4 text-center">
                    <div class="card border-0 shadow-sm rounded-4 mb-2 p-3 d-flex align-items-center justify-content-center" style="height: 80px;"><i class="bi bi-book fs-1 text-secondary"></i></div>
                    <small class="fw-bold text-dark">Books</small>
                </div>
            </div>
            <h6 class="text-muted small fw-bold mt-4 mb-2 px-1">UPDATES</h6>
            <div class="card border-0 shadow-sm rounded-4">
                <div class="list-group list-group-flush">
                    <div class="list-group-item p-3">
                        <div class="d-flex align-items-center gap-3"><i class="bi bi-file-pdf text-danger fs-4"></i><div><h6 class="mb-0 fw-bold text-dark">SSC Notification</h6><small class="text-muted">2 hours ago</small></div><i class="bi bi-download ms-auto text-primary"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="profile-screen" class="screen">
            <div class="card border-0 shadow-sm rounded-4 mx-2 mt-2 p-3">
                <div class="d-flex align-items-center gap-3 mb-3">
                    <div class="position-relative">
                        <img src="https://ui-avatars.com/api/?name=User" class="rounded-circle border" style="width: 75px; height: 75px; object-fit: cover;" id="profile-img-display">
                        <div class="position-absolute bottom-0 end-0 bg-primary text-white rounded-circle d-flex align-items-center justify-content-center border border-white" style="width: 26px; height: 26px;"><i class="bi bi-camera-fill" style="font-size: 13px;"></i></div>
                    </div>
                    <div style="line-height: 1.2;">
                        <h5 class="fw-bold mb-0 text-dark" id="profile-name-display">User Name</h5>
                        <small class="text-muted" id="profile-email-display">@username</small><br>
                        <span class="badge bg-light text-primary border mt-1 rounded-pill">Student</span>
                    </div>
                </div>
                <div class="mb-3"><p class="small text-dark mb-0">ðŸŽ¯ Aspirant | ðŸ“š Student</p></div>
                <div class="d-flex justify-content-between align-items-center text-center border-top pt-3">
                    <div style="flex: 1;"><h6 class="fw-bold mb-0 text-dark">12</h6><small class="text-muted" style="font-size: 11px;">Posts</small></div>
                    <div style="border-left: 1px solid #dee2e6; height: 25px;"></div>
                    <div style="flex: 1;"><h6 class="fw-bold mb-0 text-dark">1.5k</h6><small class="text-muted" style="font-size: 11px;">Followers</small></div>
                    <div style="border-left: 1px solid #dee2e6; height: 25px;"></div>
                    <div style="flex: 1;"><h6 class="fw-bold mb-0 text-dark">400</h6><small class="text-muted" style="font-size: 11px;">Following</small></div>
                </div>
            </div>
            <div class="card border-0 shadow-sm rounded-4 mx-2 mt-3 overflow-hidden">
                <div class="list-group list-group-flush">
                    <div class="list-group-item p-3 d-flex align-items-center" onclick="openAccountCentre()">
                        <i class="bi bi-person-circle fs-5 me-3 text-primary"></i><div class="flex-grow-1"><h6 class="mb-0 fw-bold small text-dark">Account Centre</h6></div><i class="bi bi-chevron-right text-muted small"></i>
                    </div>
                    <div class="list-group-item p-3 d-flex align-items-center" onclick="openSettings()">
                        <i class="bi bi-gear fs-5 me-3 text-primary"></i><div class="flex-grow-1"><h6 class="mb-0 fw-bold small text-dark">Settings</h6></div><i class="bi bi-chevron-right text-muted small"></i>
                    </div>
                </div>
            </div>
            <div class="d-grid px-3 mt-4 mb-5"><button class="btn btn-outline-danger rounded-pill py-2 fw-bold" onclick="handleLogout()">Logout</button></div>
        </div>

        <div id="message-screen" class="screen">
            <h5 class="fw-bold mb-3">Messages</h5>
            <div class="card border-0 shadow-sm rounded-4 p-4 text-center text-muted">
                <i class="bi bi-chat-square-text fs-1 mb-2"></i><p>Start a discussion.</p>
            </div>
        </div>

        <div id="notification-screen" class="screen">
            <h5 class="fw-bold mb-3">Notifications</h5>
            <div class="card border-0 shadow-sm rounded-4 p-4 text-center text-muted">No new notifications.</div>
        </div>

    </div> <div id="fab-btn" class="fab-main" data-bs-toggle="modal" data-bs-target="#createPostModal"><i class="bi bi-plus-lg"></i></div>

    <div class="nav-wrapper">
        <button class="nav-item-btn active" onclick="switchTab('home', this)"><i class="bi bi-house-door-fill"></i><span>Home</span></button>
        <button class="nav-item-btn" onclick="switchTab('search', this)"><i class="bi bi-search"></i><span>Search</span></button>
        <button class="nav-item-btn" onclick="switchTab('study', this)"><i class="bi bi-book-half"></i><span>Study</span></button>
        <button class="nav-item-btn" onclick="switchTab('profile', this)"><i class="bi bi-person"></i><span>Profile</span></button>
    </div>

    <div id="settings-screen">
        <div class="app-header sticky-top bg-transparent shadow-none border-bottom-0">
            <div class="d-flex align-items-center gap-3"><i class="bi bi-arrow-left fs-4 text-dark" onclick="closeSettings()"></i><h5 class="mb-0 fw-bold text-dark">Settings</h5></div>
        </div>
        <div class="container pb-5 pt-2">
            <h6 class="text-muted small fw-bold mt-3 mb-2 px-2">PREFERENCES</h6>
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="list-group list-group-flush">
                    <div class="list-group-item p-3 d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-3"><i class="bi bi-moon fs-5"></i> <span>Dark Mode</span></div><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode()"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="account-screen">
        <div class="app-header sticky-top bg-transparent shadow-none border-bottom-0">
            <div class="d-flex align-items-center gap-3"><i class="bi bi-arrow-left fs-4 text-dark" onclick="closeAccountCentre()"></i><h5 class="mb-0 fw-bold text-dark">Account Centre</h5></div>
        </div>
        <div class="container pb-5 pt-2">
            <form id="account-form">
                <div class="mb-3"><label class="form-label small fw-bold text-muted">Name</label><input type="text" class="form-control rounded-3 py-2" id="ac-name"></div>
                <div class="d-grid gap-2 mt-4"><button type="button" class="btn btn-primary rounded-pill py-2 fw-bold" onclick="saveProfileChanges()">Save Changes</button></div>
            </form>
        </div>
    </div>

    <div class="modal fade" id="createPostModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
            <div class="modal-content border-0 rounded-4">
                <div class="modal-header border-0 pb-0"><h5 class="modal-title fw-bold">Create Post</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <textarea id="post-text" class="form-control border-0 fs-5 mb-3" rows="3" placeholder="What's on your mind?"></textarea>
                    <div id="poll-section" class="card bg-light border-0 rounded-3 p-3 mb-3" style="display: none;">
                        <input type="text" class="form-control mb-2 fw-bold border-0" placeholder="Question...">
                        <input type="text" class="form-control form-control-sm border-0 mb-2" placeholder="Option A">
                        <input type="text" class="form-control form-control-sm border-0 mb-2" placeholder="Option B">
                    </div>
                    <div class="card border rounded-pill p-2 mt-3">
                        <div class="d-flex justify-content-between px-2">
                            <div class="d-flex gap-1">
                                <button class="btn btn-light rounded-circle text-primary" onclick="document.getElementById('cam-input').click()"><i class="bi bi-camera-fill"></i></button><input type="file" id="cam-input" hidden>
                                <button class="btn btn-light rounded-circle text-danger" onclick="togglePoll()"><i class="bi bi-bar-chart-fill"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0"><button type="button" class="btn btn-primary w-100 rounded-pill py-2 fw-bold" onclick="savePost()">Post</button></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- 1. CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyA_suE-En5oIv3z04gJV5TPhlDwYyx-QFI",
            authDomain: "masd-repo-git.firebaseapp.com",
            projectId: "masd-repo-git",
            storageBucket: "masd-repo-git.firebasestorage.app",
            messagingSenderId: "317994984658",
            appId: "1:317994984658:web:c55231ca09e70341c8f90b"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- 2. AUTH LOGIC ---
        auth.onAuthStateChanged(user => {
            if (user) {
                document.body.classList.add('logged-in');
                updateProfileUI(user);
                loadPosts();
            } else {
                document.body.classList.remove('logged-in');
            }
        });

        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            auth.signInWithEmailAndPassword(email, pass).catch(e => document.getElementById('auth-error').innerText = e.message);
        }

        function handleSignup() {
            const email = document.getElementById('signup-email').value;
            const pass = document.getElementById('signup-pass').value;
            const name = document.getElementById('signup-name').value;
            auth.createUserWithEmailAndPassword(email, pass).then(cred => {
                cred.user.updateProfile({ displayName: name }).then(() => location.reload());
            }).catch(e => document.getElementById('signup-error').innerText = e.message);
        }
        function handleLogout() { if(confirm("Logout?")) auth.signOut(); }

        // --- 3. APP LOGIC ---
        function switchTab(id, el) {
            // Hide all screens inside container
            document.querySelectorAll('.container .screen').forEach(s => s.classList.remove('active'));
            // Show selected screen
            const target = document.getElementById(id + '-screen');
            if(target) target.classList.add('active');
            
            // Handle active nav state
            document.querySelectorAll('.nav-item-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');

            // FAB Logic
            const fab = document.getElementById('fab-btn');
            fab.style.display = (id === 'home') ? 'flex' : 'none';
        }

        function openScreen(id) {
            document.querySelectorAll('.container .screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id + '-screen').classList.add('active');
            document.getElementById('fab-btn').style.display = 'none'; // Hide FAB on other screens
        }

        function loadPosts() {
            const container = document.getElementById('posts-container');
            db.collection("posts").orderBy("timestamp", "desc").onSnapshot(snap => {
                let html = "";
                snap.forEach(doc => {
                    let data = doc.data();
                    let dp = `https://ui-avatars.com/api/?name=${data.userName}&background=random&color=fff`;
                    html += `
                    <div class="card border-0 shadow-sm rounded-4 mb-3">
                        <div class="card-body p-3">
                            <div class="d-flex gap-2 align-items-center mb-2">
                                <img src="${dp}" class="rounded-circle" width="40" height="40">
                                <div><h6 class="mb-0 fw-bold">${data.userName}</h6></div>
                            </div>
                            <p>${data.text}</p>
                            <div class="d-flex justify-content-between pt-2 border-top text-muted">
                                <i class="bi bi-chat"></i><i class="bi bi-heart"></i><i class="bi bi-share"></i>
                            </div>
                        </div>
                    </div>`;
                });
                container.innerHTML = html || "<p class='text-center mt-5'>No posts yet</p>";
            });
        }

        function savePost() {
            const text = document.getElementById('post-text').value;
            if(!text) return;
            db.collection("posts").add({
                text: text,
                userName: auth.currentUser.displayName || "User",
                userEmail: auth.currentUser.email,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('post-text').value = "";
                bootstrap.Modal.getInstance(document.getElementById('createPostModal')).hide();
            });
        }

        function togglePoll() {
            const s = document.getElementById('poll-section');
            s.style.display = s.style.display === 'none' ? 'block' : 'none';
        }

        // --- 4. OVERLAYS & HELPERS ---
        function updateProfileUI(user) {
            if(document.getElementById('profile-name-display')) {
                document.getElementById('profile-name-display').innerText = user.displayName || "User";
                document.getElementById('profile-email-display').innerText = "@" + user.email.split('@')[0];
                document.getElementById('profile-img-display').src = `https://ui-avatars.com/api/?name=${user.displayName}&background=0d6efd&color=fff`;
            }
        }
        function openSettings() { document.getElementById('settings-screen').classList.add('active'); }
        function closeSettings() { document.getElementById('settings-screen').classList.remove('active'); }
        function openAccountCentre() { 
            document.getElementById('account-screen').classList.add('active'); 
            document.getElementById('ac-name').value = auth.currentUser.displayName;
        }
        function closeAccountCentre() { document.getElementById('account-screen').classList.remove('active'); }
        function saveProfileChanges() {
            const n = document.getElementById('ac-name').value;
            if(n) auth.currentUser.updateProfile({displayName: n}).then(() => location.reload());
        }
        function toggleDarkMode() {
            document.body.classList.toggle('dark-theme');
        }
    </script>
</body>
</html>
